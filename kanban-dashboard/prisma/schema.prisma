// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// NOTE: models have either id or code fields
// Models whose primary key is not explicitly used by cal poly have an id field although it may be something aquired from cal poly such as 
// the degree id which is determined from the degree page url path on the catalog site
// Models (such as subject) whose primary key is used by cal poly have a code field

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Department {
  id     String   @id
  name   String   @unique
  Degree Degree[]
}

model Course {
  code                  String  @id
  subjectCode           String
  subject               Subject @relation(fields: [subjectCode], references: [code])
  title                 String
  number                Int
  description           String  @db.LongText
  // string because it can be range or single number and we only need
  // to display it either way
  minUnits              Int
  maxUnits              Int
  // string of comma separated terms
  // TODO: make this a bitmask
  termsTypicallyOffered String

  fulfillsRequirements CourseRequirement[]
}

model Subject {
  code    String   @id
  name    String
  courses Course[]
}

model CourseRequirement {
  // TODO: figure out how to make unique ids based on the CourseRequirement
  course              Course  @relation(fields: [courseCode], references: [code])
  degree              Degree  @relation(fields: [degreeId], references: [id])
  // Ge, major, tech elective, etc.
  // TODO: make this an enum
  kind                String?
  // 0,1,2,3
  recommendedYear     Int?
  recommendedTermCode Int?

  courseCode String
  degreeId   String

  @@id([courseCode, degreeId])
}

model Degree {
  id                 String              @id
  name               String
  link               String
  // TODO: make this an enum of BS, BA, etc.
  kind               String
  courseRequirements CourseRequirement[]
  Department         Department?         @relation(fields: [departmentId], references: [id])
  departmentId       String?

  @@unique([name, kind])
}

model User {
  calPolyUsername String          @id
  year            Int
  flowcharts      UserFlowchart[]
}

model UserFlowchart {
  id                  Int    @id @default(autoincrement())
  user                User   @relation(fields: [userCalPolyUsername], references: [calPolyUsername])
  startYear           Int
  userCalPolyUsername String
}
